<div class="page">
  <header class="topbar">
    <div class="brand">
      <div class="logo">T</div>
      <div class="brandText">
        <h1>Taskify</h1>
        <p>Your Project Management Tool</p>
      </div>
    </div>

    <div class="actions">
      <button class="btn ghost" type="button" (click)="openCreateModal()">
        + New Board
      </button>
    </div>
  </header>

  <section class="section">
    <div class="sectionHead">
      <div>
        <h2>Your Boards</h2>
        <p class="muted">Select a board to open it.</p>
      </div>

      <div class="status">
        <span *ngIf="isLoading" class="badge">Loading</span>
        <span *ngIf="useDemoData" class="badge warn">Demo mode</span>
        <span *ngIf="!isLoading && !useDemoData && !apiError && !errorMsg" class="badge ok">Connected</span>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="state-text">
      Loading boards...
    </div>

    <app-error-banner
      *ngIf="!isLoading && errorMsg"
      title="Backend unreachable"
      [message]="errorMsg"
      hint="Make sure the backend server is running (port 8080) or configure API base URL for deployment."
      [canRetry]="true"
      (retry)="loadProjects()"
      (dismiss)="errorMsg = ''"
    ></app-error-banner>

    <!-- Empty -->
    <div *ngIf="!isLoading && !errorMsg && (!projects || projects.length === 0)" class="state-text">
      No boards yet. Create your first board to get started.
    </div>

    <!-- Grid -->
    <div *ngIf="!isLoading && !errorMsg && projects?.length" class="grid">
      <!-- Project Cards -->
      <button
        class="card"
        type="button"
        *ngFor="let project of projects; let i = index"
        (click)="openBoard(project.id)"
      >
        <div class="cardTop">
          <div class="avatar" [style.background]="getProjectColor(i)">
            {{ (project.name || 'B').slice(0,1).toUpperCase() }}
          </div>

          <!-- Delete action -->
          <button
            class="iconBtn"
            type="button"
            title="Delete board"
            aria-label="Delete board"
            (click)="$event.stopPropagation(); openDeleteModal(project)"
          >
            ⋮
          </button>
        </div>

        <div class="title">{{ project.name }}</div>
        <div class="desc">{{ project.description || 'No description yet' }}</div>
      </button>

      <!-- Create tile (keep it) -->
      <button class="card create" type="button" (click)="openCreateModal()">
        <div class="plus">+</div>
        <div class="title">Create new board</div>
        <div class="desc">Start with a blank board</div>
      </button>
    </div>
  </section>

  <!-- CREATE MODAL -->
  <div *ngIf="showCreateModal" class="modalBackdrop" (click)="closeCreateModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modalHead">
        <div>
          <h3>Create new board</h3>
          <p class="muted">Add a name and optional description.</p>
        </div>
        <button class="iconBtn" type="button" (click)="closeCreateModal()">✕</button>
      </div>

      <div class="modalBody">
        <label class="field">
          <span>Name</span>
          <input [(ngModel)]="newBoardName" placeholder="e.g., Sprint Planning" />
        </label>

        <label class="field">
          <span>Description</span>
          <textarea [(ngModel)]="newBoardDesc" rows="3" placeholder="Short summary..."></textarea>
        </label>
      </div>

      <div class="modalFoot">
        <button class="btn ghost" type="button" (click)="closeCreateModal()">Cancel</button>
        <button class="btn primary" type="button" (click)="createNewBoard()"
          [disabled]="creating || !newBoardName.trim()">
          {{ creating ? 'Creating...' : 'Create' }}
        </button>
      </div>
    </div>
  </div>

  <!-- DELETE MODAL -->
  <div *ngIf="showDeleteModal" class="modalBackdrop" (click)="closeDeleteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modalHead">
        <div>
          <h3>Delete board</h3>
          <p class="muted">This action cannot be undone.</p>
        </div>
        <button class="iconBtn" type="button" (click)="closeDeleteModal()">✕</button>
      </div>

      <div class="modalBody">
        <p>
          Are you sure you want to delete
          <b>{{ projectToDelete?.name }}</b>?
        </p>
      </div>

      <div class="modalFoot">
        <button class="btn ghost" type="button" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn danger" type="button" (click)="confirmDeleteBoard()"
          [disabled]="deleting">
          {{ deleting ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </div>
  </div>
</div>
